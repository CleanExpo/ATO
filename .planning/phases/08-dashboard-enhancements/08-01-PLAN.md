---
phase: 08-dashboard-enhancements
plan: 01
type: execute
domain: next-js
---

<objective>
Build an interactive transaction explorer that allows users to filter, sort, search, and drill down into analysed transactions.

Purpose: Enable accountants and business owners to quickly find specific transactions and understand their tax classifications without downloading CSV files.
Output: New `/dashboard/forensic-audit/transactions` page with filterable data grid showing all analysed transactions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@D:/ATO/app/dashboard/forensic-audit/recommendations/page.tsx
@D:/ATO/app/api/audit/analysis-results/route.ts
@D:/ATO/components/forensic-audit/ExpandableRecommendationCard.tsx

**Tech Stack Available:**
- Next.js 16 with App Router
- React 19
- Tailwind CSS 4
- framer-motion for animations
- lucide-react for icons
- Scientific Luxury design system (OLED black, spectral colours, single-pixel borders)

**Established Patterns:**
- Client components with 'use client' directive
- Suspense boundaries for loading states
- BreathingOrb component for status indicators
- SPECTRAL colour tokens (cyan, emerald, amber, red, magenta)
- Motion animations with outExpo easing

**API Available:**
- GET /api/audit/analysis-results - returns paginated analysis results with filtering
- Query params: tenantId, financialYear, isRndCandidate, primaryCategory, minConfidence, page, pageSize
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Transaction Explorer Page</name>
  <files>app/dashboard/forensic-audit/transactions/page.tsx</files>
  <action>
Create a new page at `/dashboard/forensic-audit/transactions` that:

1. Uses Scientific Luxury design system (OLED black #050505 background, spectral colours)
2. Fetches transactions from `/api/audit/analysis-results` API
3. Implements client-side state for filters:
   - Financial Year dropdown (FY2020-21 through FY2025-26)
   - Category filter (dropdown with all categories)
   - R&D Candidate toggle (Yes/No/All)
   - Confidence slider (0-100)
   - Search input (supplier name, description)
4. Displays transactions in a responsive table/grid with columns:
   - Date, Supplier, Amount, Category, Confidence, R&D Candidate, Deduction Type
5. Supports sorting by clicking column headers
6. Uses framer-motion for row entrance animations
7. Shows loading state with BreathingOrb component
8. Includes pagination controls at bottom

Reference existing patterns in recommendations/page.tsx for styling and component structure.
Use formatCurrency helper for amounts.
Handle empty state gracefully with clear message.
  </action>
  <verify>
Navigate to /dashboard/forensic-audit/transactions?tenantId=8a8caf6c-614b-45a5-9e15-46375122407c
Page loads with transactions displayed in table format
  </verify>
  <done>
Transaction explorer page renders with data grid showing all analysed transactions
Filters visible but not yet functional (next task)
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Filtering and Sorting</name>
  <files>app/dashboard/forensic-audit/transactions/page.tsx</files>
  <action>
Add interactive filtering and sorting to the transaction explorer:

1. Wire up filter state to API calls:
   - When filter changes, refetch with new query params
   - Debounce search input (300ms delay)
   - Update URL params for shareable links (use useSearchParams)

2. Implement column sorting:
   - Click header to sort ascending, click again for descending
   - Visual indicator (arrow) showing sort direction
   - Sort by: date, amount, confidence, supplier

3. Add filter summary strip showing active filters:
   - "Showing X of Y transactions"
   - "Filtered by: FY2024-25, R&D Candidates, Confidence > 80%"
   - Clear all filters button

4. Implement pagination:
   - Page size selector (25, 50, 100, 500)
   - Previous/Next buttons
   - Page number display "Page 1 of 40"

Use existing SPECTRAL colour tokens for filter buttons (cyan for active).
Don't use external table libraries - build with native HTML table + Tailwind.
  </action>
  <verify>
Filters modify displayed transactions correctly
Sorting works on all sortable columns
URL updates with filter params (shareable)
  </verify>
  <done>
All filters functional and connected to API
Column sorting works with visual indicators
Pagination controls navigate through results
URL reflects current filter state
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Transaction Detail Expansion</name>
  <files>app/dashboard/forensic-audit/transactions/page.tsx, components/forensic-audit/TransactionDetailRow.tsx</files>
  <action>
Create expandable transaction rows that show full analysis details:

1. Create TransactionDetailRow component:
   - Collapsible row that expands on click
   - Shows: full description, R&D reasoning, compliance notes, legislative reference
   - R&D criteria breakdown (if R&D candidate): outcomeUnknown, systematicApproach, newKnowledge, scientificMethod
   - FBT/Division 7A flags with explanations
   - Claimable amount vs transaction amount
   - Link to view in Xero (if invoice ID available)

2. Add expand/collapse animation using framer-motion AnimatePresence

3. Style expanded row:
   - Darker background (#0a0a0f)
   - Left border accent matching category colour
   - Grid layout for detail fields
   - Monospace font for amounts and IDs

4. Add row selection:
   - Checkbox for multi-select
   - "Export Selected" button appears when rows selected
   - Store selected transaction IDs in state
  </action>
  <verify>
Click transaction row to expand
Detail view shows all analysis fields
Animation smooth on expand/collapse
  </verify>
  <done>
TransactionDetailRow component created
Rows expand to show full analysis details
Selection checkboxes functional
Expand/collapse animation working
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Transaction explorer page accessible at /dashboard/forensic-audit/transactions
- [ ] Filters work correctly (FY, category, R&D, confidence, search)
- [ ] Sorting works on columns with visual indicators
- [ ] Row expansion shows full transaction details
- [ ] Pagination navigates through large datasets
- [ ] Mobile responsive (table scrolls horizontally)
</verification>

<success_criteria>
- All 3 tasks completed
- Build passes without TypeScript errors
- Transaction explorer functional with 10,000+ transactions
- Filters and sorting performant (< 500ms response)
- Follows Scientific Luxury design system
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-enhancements/08-01-SUMMARY.md`
</output>
