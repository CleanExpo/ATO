# PLAN 10-03: R&D Claim Preparation Checklist

## Objective
Build a comprehensive claim preparation checklist that guides users through all required documentation, AusIndustry registration steps, and Schedule 16N preparation for their R&D Tax Incentive claim.

## Execution Context
- Builds on Plans 10-01 (registration tracking) and 10-02 (evidence collection)
- Uses CARSI registration guide as content reference (`.planning/carsi-rnd-registration-guide.md`)
- Scientific Luxury design system
- Export/print functionality for offline use

## Context
- AusIndustry registration requires specific information
- Schedule 16N is complex and requires precise data
- Common pitfalls cause delays and rejections
- Users need a clear roadmap from evidence to submission

## Tasks

### Task 1: Checklist Schema
**Files to create:**
- `lib/supabase/migrations/20260127_rnd_checklist.sql`
- `lib/types/rnd-checklist.ts`

**Schema:**
```sql
-- R&D Checklist items with completion tracking
CREATE TABLE rnd_checklist_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id TEXT NOT NULL,
    registration_id UUID REFERENCES rnd_registrations(id),
    category TEXT NOT NULL, -- 'documentation', 'registration', 'tax_return', 'post_submission'
    item_key TEXT NOT NULL, -- Unique key for item (e.g., 'doc_project_plan')
    is_completed BOOLEAN DEFAULT FALSE,
    completed_at TIMESTAMPTZ,
    completed_by TEXT,
    notes TEXT,
    document_id UUID, -- Optional link to uploaded document
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(tenant_id, registration_id, item_key)
);

-- Checklist templates (read-only reference data)
CREATE TABLE rnd_checklist_templates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    category TEXT NOT NULL,
    item_key TEXT UNIQUE NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    legislation_reference TEXT, -- e.g., 's 355-25 ITAA 1997'
    is_mandatory BOOLEAN DEFAULT TRUE,
    display_order INTEGER,
    help_url TEXT
);

-- Insert standard checklist template items
INSERT INTO rnd_checklist_templates (category, item_key, title, description, legislation_reference, is_mandatory, display_order) VALUES
-- Documentation category
('documentation', 'doc_project_plan', 'Project Plan', 'Document describing objectives, hypotheses, methodology, and timeline', 's 355-25 ITAA 1997', TRUE, 1),
('documentation', 'doc_technical_uncertainty', 'Technical Uncertainty Documentation', 'Records of knowledge gaps and uncertainties at project start', 's 355-25(1)(a)', TRUE, 2),
('documentation', 'doc_systematic_approach', 'Systematic Approach Records', 'Evidence of systematic progression of work', 's 355-25(1)(b)', TRUE, 3),
('documentation', 'doc_new_knowledge', 'New Knowledge Evidence', 'Documentation of new knowledge generated', 's 355-25(1)(c)', TRUE, 4),
('documentation', 'doc_scientific_method', 'Scientific Method Records', 'Evidence of scientific/engineering principles used', 's 355-25(1)(d)', TRUE, 5),
('documentation', 'doc_contemporaneous', 'Contemporaneous Records', 'Lab notebooks, development logs, meeting minutes', 's 355-25', TRUE, 6),
('documentation', 'doc_expenditure', 'Expenditure Records', 'Timesheets, invoices, asset register for R&D activities', 's 355-205', TRUE, 7),
-- Registration category
('registration', 'reg_mygovid', 'myGovID Setup', 'Ensure myGovID is linked to business.gov.au', NULL, TRUE, 1),
('registration', 'reg_activity_description', 'Activity Descriptions', 'Prepare R&D activity descriptions for registration form', 's 27A IRDA', TRUE, 2),
('registration', 'reg_expenditure_estimate', 'Expenditure Estimate', 'Calculate and document estimated R&D expenditure', 's 27J IRDA', TRUE, 3),
('registration', 'reg_submission', 'Submit Registration', 'Submit registration via business.gov.au before deadline', 's 27A IRDA', TRUE, 4),
('registration', 'reg_confirmation', 'Registration Confirmation', 'Save AusIndustry registration reference number', NULL, TRUE, 5),
-- Tax return category
('tax_return', 'tax_schedule_16n', 'Schedule 16N', 'Complete R&D Tax Incentive Schedule', NULL, TRUE, 1),
('tax_return', 'tax_company_return', 'Company Tax Return', 'Include R&D offset claim in tax return', NULL, TRUE, 2),
('tax_return', 'tax_lodgement', 'Lodge Tax Return', 'Submit tax return with R&D schedule', NULL, TRUE, 3),
-- Post-submission category
('post_submission', 'post_records_retention', 'Records Retention', 'Retain all R&D records for 5 years', 's 262A ITAA 1936', TRUE, 1),
('post_submission', 'post_amendment_period', 'Note Amendment Period', 'Track 4-year amendment period', 's 170 ITAA 1936', FALSE, 2);
```

### Task 2: Checklist API Endpoints
**Files to create:**
- `app/api/rnd/checklist/route.ts` - GET checklist with completion status
- `app/api/rnd/checklist/[itemKey]/route.ts` - PATCH item completion
- `app/api/rnd/checklist/export/route.ts` - Export checklist as PDF/CSV

**Endpoints:**
1. `GET /api/rnd/checklist?tenantId=X&registrationId=Y` - Get checklist with completion status
2. `PATCH /api/rnd/checklist/[itemKey]` - Update item completion status
3. `GET /api/rnd/checklist/export?tenantId=X&registrationId=Y&format=pdf` - Export checklist

### Task 3: Checklist UI Components
**Files to create:**
- `components/rnd/ClaimChecklist.tsx` - Main checklist container
- `components/rnd/ChecklistCategory.tsx` - Category accordion with items
- `components/rnd/ChecklistItem.tsx` - Individual checklist item
- `components/rnd/ChecklistProgress.tsx` - Overall progress indicator
- `components/rnd/ChecklistExport.tsx` - Export button with format options

**ClaimChecklist:**
- Four categories in accordion layout
- Overall progress percentage
- Filter: All / Incomplete / Completed
- Search items
- Export button

**ChecklistCategory:**
- Expandable section for each category
- Category progress indicator (X of Y complete)
- List of items within category

**ChecklistItem:**
- Checkbox with title
- Description expandable
- Legislation reference link
- Notes field (optional)
- Document upload link (optional)
- Mandatory badge

**ChecklistProgress:**
- Circular progress indicator
- Percentage complete
- Items remaining count
- Estimated time to completion (optional)

### Task 4: Checklist Page
**Files to create:**
- `app/dashboard/forensic-audit/rnd/checklist/page.tsx`

**Features:**
- Full-page checklist view
- Filter and search
- Progress tracking
- Export functionality
- Links to evidence wizard
- Links to AusIndustry portal

### Task 5: AusIndustry Registration Guidance
**Files to create:**
- `components/rnd/AusIndustryGuide.tsx` - Step-by-step registration guide
- `lib/rnd/ausindustry-steps.ts` - Registration process content

**Content:**
```typescript
const AUSINDUSTRY_STEPS = [
  {
    step: 1,
    title: "Set up myGovID",
    description: "Create or verify your myGovID digital identity",
    url: "https://www.mygovid.gov.au/",
    tips: [
      "Use Standard or Strong identity strength",
      "Link to business.gov.au"
    ]
  },
  {
    step: 2,
    title: "Log into business.gov.au",
    description: "Access the R&D Tax Incentive portal",
    url: "https://business.gov.au/grants-and-programs/research-and-development-tax-incentive",
    tips: [
      "Ensure you have authorisation to act for the company"
    ]
  },
  // ... more steps
];
```

**AusIndustryGuide:**
- Step-by-step cards with external links
- Tips for each step
- Common pitfalls to avoid
- Estimated time per step

### Task 6: Schedule 16N Helper
**Files to create:**
- `components/rnd/Schedule16NHelper.tsx`
- `lib/rnd/schedule-16n-fields.ts` - Field definitions

**Features:**
- Explanation of each Schedule 16N field
- Auto-populated values from analysis
- Validation of entered values
- Export data for tax agent
- Links to ATO guidance

## Verification
- [ ] `npm run build` succeeds
- [ ] Checklist tables created in Supabase
- [ ] Template items seeded correctly
- [ ] Checklist items persist completion status
- [ ] Progress calculates correctly
- [ ] Export generates valid PDF/CSV
- [ ] AusIndustry guide links work

## Success Criteria
- Users have clear step-by-step guidance for R&D claim
- All mandatory documentation is tracked
- Progress is visible and encouraging
- Checklist can be exported for offline use
- Integration with evidence wizard is clear
- Registration process is demystified

## Output
- 1 migration file (SQL with seed data)
- 1 types file (TypeScript)
- 3 API route files
- 7 component files
- 2 content files
- 1 new page file
